<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>寻路算法可视化</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>寻路算法可视化</h1>

        <div class="controls">
            <div class="control-group">
                <label>场地大小:</label>
                <select id="gridSize" onchange="updateGridInputs()">
                    <option value="small">小场地 (20x20)</option>
                    <option value="medium">中场地 (30x30)</option>
                    <option value="large">大场地 (40x40)</option>
                </select>
                <input type="number" id="gridWidth" value="20" min="10" max="50" style="width: 60px;">
                <span>x</span>
                <input type="number" id="gridHeight" value="20" min="10" max="50" style="width: 60px;">
                <button onclick="initializeGrid()">初始化网格</button>
            </div>

            <div class="control-group">
                <label>算法选择:</label>
                <select id="algorithmSelect">
                    <option value="astar">A* 算法</option>
                    <option value="dijkstra">Dijkstra 算法</option>
                    <option value="bfs">广度优先搜索</option>
                    <optgroup id="customAlgorithmsGroup" label="自定义算法">
                        <!-- 自定义算法将动态添加到这里 -->
                    </optgroup>
                </select>
            </div>

            <div class="control-group">
                <label>启发式函数:</label>
                <select id="heuristicSelect">
                    <option value="manhattan">曼哈顿距离</option>
                    <option value="euclidean">欧几里得距离</option>
                    <option value="diagonal">对角距离</option>
                </select>
            </div>

            <div class="control-group">
                <label>
                    <input type="checkbox" id="diagonalCheckbox"> 允许对角线移动
                </label>
            </div>

            <div class="control-group">
                <label>已访问路径速度:</label>
                <select id="visitedSpeed">
                    <option value="fast" selected>最快</option>
                    <option value="medium">中等</option>
                    <option value="slow">慢速</option>
                    <option value="very-slow">很慢</option>
                    <option value="ultra-slow">极慢</option>
                </select>
                <button onclick="adjustVisitedSpeed(-1)">调慢</button>
                <button onclick="adjustVisitedSpeed(1)">调快</button>
            </div>

            <div class="control-group">
                <label>移动速度:</label>
                <select id="movementSpeed">
                    <option value="fast" selected>最快</option>
                    <option value="medium">中等</option>
                    <option value="slow">慢速</option>
                </select>
                <button onclick="adjustMovementSpeed(-1)">调慢</button>
                <button onclick="adjustMovementSpeed(1)">调快</button>
            </div>

            <div class="control-group">
                <button onclick="startPathfinding()" id="startBtn">开始寻路</button>
                <button onclick="clearPath()" id="clearBtn">清除路径</button>
                <button onclick="clearAll()" id="clearAllBtn">清空网格</button>
            </div>
        </div>

        <!-- LLM 功能区域 -->
        <div class="controls" id="llmControls">
            <div class="control-group">
                <label>🤖 LLM 算法生成</label>
                <button onclick="toggleLLMSettings()" id="llmSettingsBtn">设置 LLM</button>
            </div>
            <div class="control-group">
                <button onclick="goToAlgorithmLibrary()">📖 算法库管理</button>
            </div>
            <div class="control-group">
                <div style="background-color: #e8f4fd; padding: 8px; border-radius: 4px; border-left: 4px solid #2196F3;">
                    <span style="font-size: 0.9em; color: #1976D2;">
                        <strong>💡 提示：</strong>当前使用 <strong>DeepSeek V3.1 Terminus</strong> 模型，具有更强的代码理解和生成能力
                    </span>
                </div>
            </div>
        </div>

        <!-- LLM 设置面板 -->
        <div class="llm-settings" id="llmSettings" style="display: none;">
            <h3>🤖 LLM 设置</h3>

            <div class="control-group">
                <label>API 提供商:</label>
                <select id="llmProvider" onchange="updateProviderDisplay()">
                    <option value="modelscope">魔搭社区</option>
                    <option value="siliconflow">硅基流动</option>
                    <option value="deepseek" selected>DeepSeek V3.1 Terminus</option>
                    <option value="openrouter">OpenRouter</option>
                </select>
                <button onclick="testConnection()" id="testConnectionBtn">测试连接</button>
                <span style="margin-left: 10px; color: #666; font-size: 0.9em;">当前使用: DeepSeek V3.1 Terminus</span>
            </div>

            <div class="control-group">
                <label>API 密钥:</label>
                <input type="password" id="apiKeyInput" placeholder="请输入 API 密钥">
                <button onclick="saveApiKey()" id="saveApiKeyBtn">保存密钥</button>
            </div>

            <div class="control-group">
                <label>算法描述:</label>
                <textarea id="algorithmDescription" placeholder="详细描述你想要的寻路算法，例如：&#10;1. 创建一个贪心寻路算法，每次选择距离终点最近的节点&#10;2. 实现一个双向BFS算法，从起点和终点同时搜索&#10;3. 设计一个A*变种，使用不同的启发式函数"></textarea>
            </div>

            <div class="control-group">
                <label>算法名称:</label>
                <input type="text" id="algorithmName" placeholder="自定义算法名称">
                <button onclick="generateAlgorithm()" id="generateBtn">生成算法</button>
            </div>

            <div class="control-group">
                <label>生成的代码:</label>
                <textarea id="generatedCode" readonly placeholder="生成的算法代码将显示在这里"></textarea>
            </div>

            <div class="control-group">
                <button onclick="hideLLMSettings()" id="closeSettingsBtn">关闭设置</button>
            </div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color empty"></div>
                <span>空地</span>
            </div>
            <div class="legend-item">
                <div class="legend-color wall"></div>
                <span>障碍物</span>
            </div>
            <div class="legend-item">
                <div class="legend-color start"></div>
                <span>起点</span>
            </div>
            <div class="legend-item">
                <div class="legend-color end"></div>
                <span>终点</span>
            </div>
            <div class="legend-item">
                <div class="legend-color visited"></div>
                <span>已访问</span>
            </div>
            <div class="legend-item">
                <div class="legend-color path"></div>
                <span>路径</span>
            </div>
        </div>

        <div class="grid-container">
            <div id="grid"></div>
        </div>

        <div class="status" id="status">
            点击"初始化网格"开始，然后设置起点、终点和障碍物
        </div>
    </div>

    <script src="/static/script.js"></script>
</body>
</html>