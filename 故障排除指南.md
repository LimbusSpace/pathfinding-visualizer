# 🔧 LLM功能故障排除指南

## 🚨 常见问题及解决方案

### 1. 硅基流动连接失败

#### 问题描述
点击"测试连接"时，硅基流动API无法连接。

#### 可能原因
- API密钥无效或已过期
- 账户余额不足
- 网络连接问题
- 防火墙或代理设置阻止连接

#### 解决方案

##### 方案A：验证API密钥
1. 登录硅基流动控制台: https://siliconflow.cn
2. 检查API密钥是否复制完整（特别注意开头和结尾）
3. 确认密钥状态是否为"激活"
4. 检查账户余额是否充足

##### 方案B：网络连接测试
运行专门的诊断工具：
```bash
python test_siliconflow.py
```
或者在浏览器中直接访问：
```
https://api.siliconflow.cn/v1/models
```

##### 方案C：尝试其他模型
如果连接成功但生成失败，尝试修改llm_integration.py中的模型名称：
```python
"model": "Qwen/Qwen2.5-7B-Instruct"  # 改为7B版本
```

### 2. DeepSeek连接失败

#### 问题描述
DeepSeek API连接测试失败。

#### 解决方案
1. 检查API密钥格式（应该以"sk-"开头）
2. 确认DeepSeek账户状态：https://platform.deepseek.com
3. 检查账户是否有足够的API调用额度
4. 尝试使用调试工具：
```bash
python debug_llm_connections.py
```

### 3. 魔搭社区连接失败

#### 问题描述
ModelScope API连接测试失败。

#### 解决方案
1. 确认API密钥申请流程已完成：https://modelscope.cn
2. 检查AccessKey和SecretKey配置
3. 确认服务已开通相应权限
4. 尝试在魔搭社区的控制台测试API

### 4. OpenRouter连接失败

#### 问题描述
OpenRouter API连接测试失败。

#### 解决方案
1. 确认API密钥格式正确
2. 检查账户余额：https://openrouter.ai/keys
3. 确认所选模型可用
4. 检查请求头设置（需要额外的HTTP头）

### 5. 算法生成失败

#### 问题描述
连接测试成功，但生成算法时失败。

#### 可能原因
- 算法描述不够清晰
- 模型输出格式问题
- 服务器临时错误

#### 解决方案
##### 方案A：优化算法描述
避免模糊的描述，使用具体的技术术语：

❌ 不好的描述：
```
"找一个路径"
"搞个算法"
```

✅ 好的描述：
```
"一个贪心算法，总是选择距离终点最近的节点进行探索"
"深度优先搜索算法，沿着一个方向一直探索到尽头，然后回溯"
```

##### 方案B：简化生成请求
1. 减少算法描述的复杂度
2. 使用更短的描述文本
3. 避免特殊字符和复杂语法

##### 方案C：切换模型或提供商
如果某个提供商不断失败，尝试：
1. 连接到其他提供商
2. 使用不同的模型（如7B参数模型）
3. 等待网络稳定后重试

### 6. 生成的算法无法执行

#### 问题描述
算法生成成功，但执行时出错。

#### 解决方案
1. **检查生成的代码**：查看codeArea中的代码是否有明显错误
2. **简化场景**：先在没有障碍物的简单网格中测试
3. **逐步复杂化**：简单场景测试通过后再添加障碍物
4. **重新生成**：如果持续失败，修改描述后重新生成

### 7. 前端显示错误

#### 问题描述
浏览器控制台显示JavaScript错误。

#### 解决方案
1. 打开浏览器开发者工具（F12）
2. 查看Console标签的错误信息
3. 查看Network标签的请求响应
4. 清除浏览器缓存后重试

## 🛠️ 诊断工具使用

### 使用通用调试工具
```bash
python debug_llm_connections.py
```
这个工具会：
- 测试所有配置的API提供商
- 提供详细的错误信息
- 给出针对性的解决建议

### 使用硅基流动专用测试
```bash
python test_siliconflow.py
```
这个工具会：
- 详细显示请求和响应信息
- 验证API密钥格式
- 提供具体的错误分析

## 🔍 浏览器开发者工具使用

### 查看网络请求
1. F12打开开发者工具
2. 切换到Network标签
3. 尝试连接测试或生成算法
4. 查看API请求的状态码和响应内容

### 常见状态码说明
- `200 OK`: 请求成功
- `401 Unauthorized`: API密钥无效
- `402 Payment Required`: 账户余额不足
- `403 Forbidden`: 权限不足
- `429 Too Many Requests`: 请求过于频繁
- `500 Internal Server Error`: 服务器内部错误
- `503 Service Unavailable`: 服务暂时不可用

### 查看JavaScript错误
1. F12打开开发者工具
2. 切换到Console标签
3. 查看红色的错误信息
4. 根据错误行号定位问题

## 📞 获取支持

### 如果问题仍然存在，请提供以下信息：

1. **环境信息**
   - 操作系统版本
   - 浏览器版本
   - Python版本

2. **错误截图**
   - 错误提示的完整截图
   - 浏览器控制台的错误信息截图

3. **API配置信息（脱敏）**
   - 使用的是哪个LLM提供商
   - API密钥的大致格式（如：sk-xxxxxx)

4. **测试结果**
   - 运行调试工具的输出结果
   - 网络请求的具体错误信息

### 寻求帮助的渠道

1. **查看详细日志**
   - 使用调试工具获取详细错误信息
   - 检查浏览器控制台的错误日志

2. **尝试替代方案**
   - 切换到其他LLM提供商
   - 使用不同的模型配置
   - 简化测试场景

3. **社区支持**
   - GitHub Issues报告问题
   - 提供完整的错误信息和复现步骤

---

**💡 提示**: 大多数连接问题都可以通过检查API密钥、网络连接和账户状态来解决。如果所有提供商都无法连接，可能是网络环境问题，建议检查防火墙或代理设置。